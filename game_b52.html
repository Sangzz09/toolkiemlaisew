<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>B52 - SHOP MINHSANG</title>
<script src="https://cdn.jsdelivr.net/npm/particles.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:url('https://i.postimg.cc/hPHzbKdb/HD-wallpaper-saturn-2-blue-galaxy-planet-ring-sky-space-stars-universe.jpg') no-repeat center center;background-size:cover;color:#fff;min-height:100vh;overflow:hidden;position:relative}
body::before{content:'';position:absolute;top:0;left:0;width:100%;height:100%;background:radial-gradient(circle at center,rgba(0,40,80,0.3) 0%,rgba(0,0,30,0.7) 100%);z-index:0}
#particles-js{position:fixed;width:100%;height:100%;z-index:1;pointer-events:none}
.header{background:rgba(13,31,54,0.95);padding:18px 25px;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid rgba(0,230,180,0.2);backdrop-filter:blur(20px);position:relative;z-index:10}
.game-title{font-size:24px;font-weight:bold;background:linear-gradient(135deg,#00e6b4,#00b4d8);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.back-btn{padding:12px 28px;background:linear-gradient(135deg,#00e6b4,#00b4d8);color:#0a1628;text-decoration:none;border-radius:12px;font-weight:bold;transition:all 0.3s;box-shadow:0 5px 15px rgba(0,230,180,0.3)}
.back-btn:hover{transform:translateY(-2px);box-shadow:0 8px 20px rgba(0,230,180,0.5)}

.iframe-container{position:absolute;top:70px;left:0;right:0;bottom:0;display:none;z-index:5}
.iframe-container iframe{width:100%;height:100%;border:none}

.robot-flash{animation:robotFlash 0.8s ease-in-out 3}
@keyframes robotFlash{
0%{filter:brightness(1) drop-shadow(0 0 0 transparent);transform:scale(1)}
50%{filter:brightness(1.3) drop-shadow(0 0 15px #00e6b4);transform:scale(1.05)}
100%{filter:brightness(1) drop-shadow(0 0 0 transparent);transform:scale(1)}
}
.widget{position:absolute;top:30px;left:30px;background:linear-gradient(145deg,#ffd66b,#d4a136);border-radius:24px;padding:25px 32px;display:none;flex-direction:column;align-items:center;font-weight:bold;width:360px;box-shadow:0 15px 35px rgba(0,0,0,0.9),inset 0 4px 12px rgba(255,255,255,0.4),0 0 50px rgba(255,215,0,0.3);border:4px solid rgba(255,215,0,0.6);cursor:move;z-index:9999;backdrop-filter:blur(10px);transition:all 0.4s ease}
.widget .session{font-size:22px;margin-bottom:16px;color:#fff;text-shadow:0 0 10px #ff0,0 0 20px #f90,0 0 30px #f60;letter-spacing:1.5px;animation:glowText 1.5s ease-in-out infinite alternate;font-weight:800}
@keyframes glowText{from{text-shadow:0 0 8px #fff,0 0 15px #f9d423,0 0 25px #ffb347}to{text-shadow:0 0 12px #ffe97a,0 0 25px #ffcc00,0 0 35px #ff9100}}
.widget .row{display:flex;justify-content:center;align-items:center;width:100%;gap:5px}
.widget .side{display:flex;flex-direction:column;align-items:center;flex:1;font-size:19px;color:#fff;text-shadow:0 0 10px #000,0 0 18px #222;font-weight:700}
.widget .dot{width:60px;height:60px;border-radius:50%;background:#1a1a1a;box-shadow:inset 0 0 20px rgba(0,0,0,0.9),0 4px 8px rgba(0,0,0,0.5);border:4px solid rgba(255,255,255,0.25);transition:all 0.5s ease;margin-bottom:8px}
.widget .on-green{background:radial-gradient(circle at 35% 35%,#c0ffc0,#00dd00,#008800);box-shadow:0 0 25px #7CFF7C,0 0 45px #00ff00,inset 0 0 20px #005500,0 8px 15px rgba(0,255,0,0.4)}
.widget .on-red{background:radial-gradient(circle at 35% 35%,#ffc0c0,#dd0000,#880000);box-shadow:0 0 25px #FF7C7C,0 0 45px #ff0000,inset 0 0 20px #550000,0 8px 15px rgba(255,0,0,0.4)}
@keyframes blink{0%,100%{opacity:1;transform:scale(1);filter:brightness(1.2)}50%{opacity:0.7;transform:scale(1.15);filter:brightness(1.5)}}
.widget .blink{animation:blink 0.8s ease-in-out infinite}
.widget .center-logo{margin:-30px 22px 0 22px;transform:scale(1);transition:transform 0.3s}
.widget .center-logo img{height:70px;border-radius:16px;box-shadow:0 0 20px rgba(0,0,0,0.9),0 0 25px gold,0 4px 12px rgba(255,215,0,0.5);animation:pulseLogo 2s ease-in-out infinite;border:3px solid rgba(255,215,0,0.6)}
@keyframes pulseLogo{0%,100%{transform:scale(1);box-shadow:0 0 20px rgba(0,0,0,0.9),0 0 25px gold}50%{transform:scale(1.08);box-shadow:0 0 30px rgba(0,0,0,0.9),0 0 40px gold,0 0 50px #ffd700}}
.widget.shake{animation:shakeAnim 0.5s}
@keyframes shakeAnim{0%{transform:translate(0,0) rotate(0deg)}10%{transform:translate(-3px,-3px) rotate(-2deg)}20%{transform:translate(3px,-2px) rotate(2deg)}30%{transform:translate(-2px,3px) rotate(-1deg)}40%{transform:translate(2px,2px) rotate(1deg)}50%{transform:translate(-3px,1px) rotate(-2deg)}60%{transform:translate(3px,-3px) rotate(2deg)}70%{transform:translate(-2px,-1px) rotate(-1deg)}80%{transform:translate(2px,3px) rotate(1deg)}90%{transform:translate(-3px,-2px) rotate(-2deg)}100%{transform:translate(0,0) rotate(0deg)}}

.wrapper{max-width:360px;margin:20px auto;background:rgba(0,20,40,0.9);padding:20px;border-radius:16px;box-shadow:0 0 25px rgba(0,200,255,0.4);backdrop-filter:blur(10px);border:1px solid rgba(0,200,255,0.3);position:relative;overflow:hidden;z-index:10;display:none}
.wrapper::before{content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:linear-gradient(to bottom right,transparent 0%,rgba(0,255,255,0.05) 50%,transparent 100%);transform:rotate(30deg);animation:shine 6s infinite linear}
@keyframes shine{0%{transform:rotate(30deg) translate(-30%,-30%)}100%{transform:rotate(30deg) translate(30%,30%)}}
.game-title-main{text-align:center;color:#00ffff;text-shadow:0 0 10px #00ffff;margin-bottom:15px;font-size:22px;letter-spacing:1px;position:relative}
.game-title-main::after{content:'';display:block;width:100px;height:2px;background:linear-gradient(90deg,transparent,#00ffff,transparent);margin:10px auto;border-radius:2px}
.prediction-box{display:flex;justify-content:space-around;align-items:center;margin:15px 0}
.prediction-item{text-align:center;flex:1}
.prediction-item .label{font-size:14px;color:#66ccff;margin-bottom:10px;text-transform:uppercase;letter-spacing:1px}
.prediction-item .value{font-size:24px;font-weight:bold;padding:10px 15px;border-radius:10px;background:rgba(0,10,20,0.7);border:1px solid rgba(0,255,255,0.3);box-shadow:0 0 15px rgba(0,200,255,0.2);min-width:90px;display:inline-block}
.status-info{background:rgba(0,60,120,0.3);border-radius:10px;padding:12px;margin:15px 0;border:1px solid rgba(0,200,255,0.2)}
.status-row{display:flex;justify-content:space-between;align-items:center;padding:6px 0;color:#fff;font-size:13px}
.status-row .stat-label{color:#00ccff}
.status-row .stat-value{font-weight:bold;color:#00ff99}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
.float-1{animation:float 3s ease-in-out infinite}
.float-2{animation:float 3s ease-in-out infinite 0.3s}
.float-3{animation:float 3s ease-in-out infinite 0.6s}
.float-4{animation:float 3s ease-in-out infinite 0.9s}
@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}
.prediction-value{animation:pulse 2s ease-in-out infinite}

.luck8-container{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:95%;max-width:420px;background:linear-gradient(145deg,rgba(10,25,47,0.98),rgba(15,35,60,0.98));backdrop-filter:blur(25px);border-radius:25px;padding:25px;border:2px solid rgba(79,195,247,0.3);box-shadow:0 20px 50px rgba(0,0,0,0.6),0 0 80px rgba(79,195,247,0.15);z-index:10;display:none}
.luck8-session{text-align:center;font-size:20px;color:#4fc3f7;margin-bottom:25px;font-weight:600;padding:12px 20px;background:rgba(79,195,247,0.1);border-radius:12px;border:1px solid rgba(79,195,247,0.3)}
.luck8-session span{color:#81d4fa;font-weight:bold;font-size:22px}
.luck8-circle-container{display:flex;justify-content:center;gap:30px;margin-bottom:25px}
.luck8-circle{width:110px;height:110px;border-radius:50%;display:flex;flex-direction:column;justify-content:center;align-items:center;background:rgba(20,40,70,0.8);border:3px solid rgba(255,255,255,0.2);transition:all 0.4s;box-shadow:0 8px 20px rgba(0,0,0,0.4)}
.luck8-tai{border-color:#00ff88;background:linear-gradient(145deg,rgba(0,255,136,0.2),rgba(0,255,136,0.05))}
.luck8-xiu{border-color:#ff4444;background:linear-gradient(145deg,rgba(255,68,68,0.2),rgba(255,68,68,0.05))}
.luck8-icon{font-size:42px;margin-bottom:8px;filter:drop-shadow(0 0 10px currentColor)}
.luck8-tai .luck8-icon{color:#00ff88}
.luck8-xiu .luck8-icon{color:#ff4444}
.luck8-label{font-size:18px;font-weight:bold;letter-spacing:1px}
.luck8-tai .luck8-label{color:#00ff88;text-shadow:0 0 10px rgba(0,255,136,0.5)}
.luck8-xiu .luck8-label{color:#ff4444;text-shadow:0 0 10px rgba(255,68,68,0.5)}
.luck8-circle.blink{animation:blink 1s ease-in-out infinite}
@keyframes blink{0%,100%{transform:scale(1);box-shadow:0 0 0 0 rgba(255,255,255,0.6)}50%{transform:scale(1.12);box-shadow:0 0 0 15px rgba(255,255,255,0);filter:brightness(1.4)}}
.luck8-history{background:rgba(15,35,60,0.6);border-radius:15px;padding:15px;border:1px solid rgba(79,195,247,0.25);max-height:250px;overflow-y:auto}
.luck8-history-title{color:#4fc3f7;font-size:14px;font-weight:bold;margin-bottom:12px;text-align:center;text-transform:uppercase;letter-spacing:1px}
.luck8-history-item{display:flex;justify-content:space-between;align-items:center;padding:10px;background:rgba(20,40,70,0.5);border-radius:8px;margin-bottom:8px;border:1px solid rgba(79,195,247,0.15);font-size:13px}
.luck8-history-item:last-child{margin-bottom:0}
.luck8-history-session{color:#81d4fa;font-weight:600;flex:0 0 80px}
.luck8-history-col{display:flex;flex-direction:column;align-items:center;flex:1}
.luck8-history-label{color:#81d4fa;font-size:10px;margin-bottom:3px;text-transform:uppercase}
.luck8-history-value{font-weight:bold;font-size:14px}
.luck8-history-status{font-size:16px;flex:0 0 30px;text-align:center}
.luck8-history::-webkit-scrollbar{width:6px}
.luck8-history::-webkit-scrollbar-track{background:rgba(20,40,70,0.3);border-radius:6px}
.luck8-history::-webkit-scrollbar-thumb{background:rgba(79,195,247,0.5);border-radius:6px}
.luck8-history::-webkit-scrollbar-thumb:hover{background:rgba(79,195,247,0.7)}

/* New Robot UI */
.draggable-box{position:fixed;top:15px;left:15px;display:flex;align-items:center;gap:12px;z-index:9999;touch-action:none;user-select:none;-webkit-user-select:none;}
.robot-container{width:150px;height:150px;animation:float 3s ease-in-out infinite;}
.robot-avatar{width:100%;height:100%;object-fit:contain;filter:drop-shadow(0 0 5px rgba(0,230,180,0.5));}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
.action-btns{position:absolute;top:-18px;left:-10px;display:flex;gap:5px;z-index:10001}
.action-btn{width:24px;height:24px;border-radius:50%;border:none;background:rgba(13,31,54,0.9);color:#00e6b4;font-weight:bold;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 5px rgba(0,0,0,0.5);border:1px solid rgba(0,230,180,0.3);transition:all 0.2s}
.action-btn:hover{transform:scale(1.1);background:#00e6b4;color:#000}
.robot-avatar{transition:transform 0.3s ease}

.prediction-box{
background:rgba(10, 25, 45, 0.9);
backdrop-filter:blur(10px);
padding:10px 15px;
border-radius:16px;
min-width:auto;
box-shadow:0 5px 20px rgba(0,0,0,0.5);
border:1px solid rgba(0, 230, 180, 0.3);
transition:all 0.4s ease;
display:flex;
flex-direction:column;
gap:4px;
}
.session-info{font-size:12px;font-weight:600;color:#88ccff;text-align:left;text-transform:uppercase;letter-spacing:0.5px;margin:0}
.waiting{color:#fff;font-size:13px;font-weight:600;text-align:left;margin:0}
.confidence{font-size:11px;font-weight:500;text-align:left;color:#00e6b4;margin:0}
.typing-cursor::after{content:'|';animation:blinkCursor 0.8s infinite;color:#00e6b4;margin-left:2px}
@keyframes blinkCursor{0%,100%{opacity:1}50%{opacity:0}}

.history-mini{margin-top:5px;max-height:120px;overflow-y:auto;width:100%;display:none;background:rgba(0,0,0,0.3);border-radius:8px;padding:5px}
.history-mini::-webkit-scrollbar{width:3px}
.history-mini::-webkit-scrollbar-thumb{background:#00e6b4;border-radius:3px}
.h-row{display:flex;justify-content:space-between;align-items:center;font-size:15px;padding:12px 10px;border-bottom:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.02)}
.h-sess{color:#ccc;font-family:monospace;font-size:14px}
.h-win{color:#00ff00;font-weight:900;text-shadow:0 0 10px rgba(0,255,0,0.5)}
.h-lose{color:#ff4444;font-weight:900;text-shadow:0 0 10px rgba(255,68,68,0.5)}
.h-wait{color:#ffff00;font-weight:bold;opacity:0.8}

.controls-container {
    position: fixed;
    bottom: 30px;
    right: 30px;
    display: flex;
    gap: 10px;
    z-index: 9990;
}
.control-btn {
    background: linear-gradient(135deg, #00e6b4, #00b4d8);
    color: #0a1628;
    border: none;
    border-radius: 50px;
    padding: 12px 20px;
    font-weight: bold;
    box-shadow: 0 5px 15px rgba(0, 230, 180, 0.4);
    cursor: pointer;
    transition: transform 0.3s;
    display: flex;
    align-items: center;
    gap: 8px;
}
.control-btn:hover { transform: scale(1.05); box-shadow: 0 8px 20px rgba(0, 230, 180, 0.6); }
.control-btn.inactive { filter: grayscale(1); opacity: 0.7; }

.history-panel {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 90%;
    max-width: 450px;
    background: rgba(10, 25, 45, 0.95);
    border: 1px solid rgba(0, 230, 180, 0.3);
    border-radius: 16px;
    padding: 0;
    z-index: 10000;
    display: none;
    backdrop-filter: blur(15px);
    box-shadow: 0 20px 60px rgba(0,0,0,0.8);
    overflow: hidden;
}
.history-header {
    padding: 20px;
    background: rgba(0, 230, 180, 0.1);
    border-bottom: 1px solid rgba(0, 230, 180, 0.2);
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.history-title { font-weight: bold; color: #00e6b4; font-size: 20px; text-transform:uppercase; letter-spacing:1px }
.history-close { background: none; border: none; color: #fff; font-size: 24px; cursor: pointer; line-height: 1; }
.history-content {
    max-height: 350px;
    overflow-y: auto;
    padding: 10px;
}
.history-content::-webkit-scrollbar { width: 4px; }
.history-content::-webkit-scrollbar-thumb { background: #00e6b4; border-radius: 4px; }

@media(max-width:600px){
.draggable-box{top:70px;left:10px;gap:8px}
.robot-container{width:100px;height:100px}
.prediction-box{padding:8px 12px;border-radius:12px}
.session-info{font-size:11px}
.waiting{font-size:12px}
.confidence{font-size:10px}
.action-btns{top:-15px;left:-5px}
.action-btn{width:22px;height:22px;font-size:12px}
.controls-container{bottom:20px;right:15px;gap:8px}
.control-btn{padding:10px 16px;font-size:13px}
.history-panel{width:95%}
.history-content{max-height:50vh}
}
</style>
<script>
let gameCode='b52';
let lastSession=null;
let lastPredictedSession=null;
let lastPrediction=null;
let isPredicting=false;

async function refresh(){
try{
let r=await fetch("/api/predict/b52");
let j=await r.json();
let data = (j && j.result) ? j.result : (j && j.data) ? j.data : j;
if(data && typeof data==='object'){
updateHitB52(data);
}
}catch(e){console.error('[refresh error]',e)}
}

function triggerRobotEffect(){
let r=document.getElementById("robotAvatar");
if(r){
r.classList.remove("robot-flash");
void r.offsetWidth;
r.classList.add("robot-flash");
}
}

function typeWriter(element, text, finalHtml) {
    element.innerHTML = "";
    element.classList.add("typing-cursor");
    let i = 0;
    let speed = 50;
    function type() {
        if (i < text.length) {
            element.textContent += text.charAt(i);
            i++;
            setTimeout(type, speed);
        } else {
            element.innerHTML = finalHtml;
            element.classList.remove("typing-cursor");
        }
    }
    type();
}

function toggleRobot(){
    let box = document.getElementById('dragBox');
    let btn = document.getElementById('robotBtn');
    if(box){
        if(box.style.display === 'none'){
            box.style.display = 'flex';
            if(btn) btn.classList.remove('inactive');
        } else {
            box.style.display = 'none';
            if(btn) btn.classList.add('inactive');
        }
    }
}

let robotRotation = 0;
function rotateRobot(){
    robotRotation += 90;
    let avatar = document.getElementById("robotAvatar");
    if(avatar){
        avatar.style.transform = `rotate(${robotRotation}deg)`;
    }
}

function toggleHistoryPanel(){
    let h = document.getElementById('historyPanel');
    if(h.style.display === 'none' || h.style.display === ''){
        h.style.display = 'block';
    } else {
        h.style.display = 'none';
    }
}

function renderHistory(history){
    let el = document.getElementById('full-history-list');
    if(!el || !history) return;
    let html = '';
    history.forEach(h => {
        let isCorrect = h.correct;
        if (isCorrect === null || isCorrect === undefined) {
            if (h.result && h.prediction && (h.result === "T√†i" || h.result === "X·ªâu")) {
                isCorrect = (h.result === h.prediction);
            }
        }
        let resClass = isCorrect === true ? 'h-win' : (isCorrect === false ? 'h-lose' : 'h-wait');
        let resText = isCorrect === true ? 'TH·∫ÆNG' : (isCorrect === false ? 'THUA' : '???');
        let actual = h.result ? h.result : '?';
        html += `<div class="h-row"><span class="h-sess">#${h.session}</span><span style="font-weight:bold;color:#fff">${h.prediction} ‚ûî ${actual}</span><span class="${resClass}">${resText}</span></div>`;
    });
    el.innerHTML = html;
}

function updateRobotUI(phien, pred, conf){
    let sessionInfo = document.getElementById("session-info-text");
    let waitingText = document.getElementById("waiting-text");
    let confidenceBox = document.getElementById("confidence-box");
    let confidenceText = document.getElementById("confidence");
    if(!sessionInfo) return;
    if(!phien || phien==="---" || phien==="N/A" || phien==="‚Äî"){
        sessionInfo.innerHTML = "ƒêang k·∫øt n·ªëi...";
        waitingText.innerHTML = "ƒêang t·∫£i d·ªØ li·ªáu...";
        confidenceBox.style.display = "none";
        return;
    }
    let phienTiepTheo = parseInt(phien) + 1;
    sessionInfo.innerHTML = `Phi√™n: #${phienTiepTheo}`;
    sessionInfo.style.display = "block";
    let confPercent = conf ? Math.round(conf*100) : 72;
    if(pred && (pred==="T√†i" || pred==="X·ªâu")){
        let color = pred==="T√†i" ? "#00ff00" : "#ff4444";
        let fullHtml = `D·ª± ƒëo√°n: <span style="color:${color};font-size:26px;font-weight:900;text-shadow:0 0 15px ${color}">${pred}</span>`;
        if (waitingText.getAttribute('data-last') !== pred) {
            typeWriter(waitingText, `D·ª± ƒëo√°n: ${pred}`, fullHtml);
            waitingText.setAttribute('data-last', pred);
        } else {
            waitingText.innerHTML = fullHtml;
        }
        confidenceText.innerHTML = `${confPercent}%`;
        confidenceText.style.color = confPercent > 70 ? "#00ff00" : "#ffaa00";
        confidenceBox.style.display = "block";
    }else{
        waitingText.innerHTML = "ƒêang ch·ªù k·∫øt qu·∫£...";
        confidenceBox.style.display = "none";
    }
}

function normalizePred(raw){
    if(!raw) return null;
    let s = String(raw).trim().toLowerCase()
        .normalize("NFD").replace(/[\u0300-\u036f]/g,"");
    if(s==='tai'||s==='t'||s==='over'||s==='big'||s==='1') return 'T√†i';
    if(s==='xiu'||s==='x'||s==='under'||s==='small'||s==='0') return 'X·ªâu';
    return null;
}

function updateGenericGame(data){
let sessionInfo = document.getElementById("session-info-text");
let waitingText = document.getElementById("waiting-text");
let confidenceBox = document.getElementById("confidence-box");
let confidenceText = document.getElementById("confidence");
if(!sessionInfo) return;
let phien = data.Phien || data.phien || data.Session || data.session || data.round || null;
let rawPred = data.du_doan || data.du_doan_tiep_theo || data.prediction || data.Ket_qua || data.ket_qua || data.KetQua || null;
let pred = normalizePred(rawPred);
let conf = data.do_tin_cay || data.confidence || 0.72;
let confPercent = conf > 1 ? Math.round(conf) : Math.round(conf * 100);
if((!phien || phien==="---" || phien==="N/A") && !pred){
sessionInfo.innerHTML = "ƒêang k·∫øt n·ªëi...";
waitingText.innerHTML = "ƒêang t·∫£i d·ªØ li·ªáu...";
confidenceBox.style.display = "none";
return;
}
let phienTiepTheo = (phien && phien!=="---" && !isNaN(parseInt(phien))) ? (parseInt(phien) + 1) : "---";
sessionInfo.innerHTML = `Phi√™n: #${phienTiepTheo}`;
sessionInfo.style.display = "block";
if(lastSession !== String(phien)){
lastSession = String(phien);
lastPredictedSession = null;
triggerRobotEffect();
}
if(pred){
let color = pred==="T√†i" ? "#00ff00" : "#ff4444";
let fullHtml = `D·ª± ƒëo√°n: <span style="color:${color};font-size:26px;font-weight:900;text-shadow:0 0 15px ${color}">${pred}</span>`;
if(waitingText.getAttribute('data-last') !== pred){
    typeWriter(waitingText, `D·ª± ƒëo√°n: ${pred}`, fullHtml);
    waitingText.setAttribute('data-last', pred);
}else{
    waitingText.innerHTML = fullHtml;
}
confidenceText.innerHTML = `${confPercent}%`;
confidenceText.style.color = confPercent > 70 ? "#00ff00" : "#ffaa00";
confidenceBox.style.display = "block";
lastPredictedSession = String(phien);
}else{
waitingText.innerHTML = "ƒêang ch·ªù k·∫øt qu·∫£...";
waitingText.removeAttribute('data-last');
confidenceBox.style.display = "none";
}
if(data.history) renderHistory(data.history);
}

function updateSicbo(data){
let sessionInfo = document.getElementById("session-info-text");
let waitingText = document.getElementById("waiting-text");
let confidenceBox = document.getElementById("confidence-box");
let confidenceText = document.getElementById("confidence");
if(!sessionInfo) return;
let phienHienTai=data.phien_hien_tai;
let phienTiepTheo=data.phien_tiep_theo;
let pred=data.du_doan;
let conf=data.do_tin_cay || 63;
let confPercent=typeof conf === 'number' ? conf : parseInt(conf);
let viDuDoan=data.vi_du_doan || [10,11,12];
if(!phienTiepTheo || phienTiepTheo==="---"){
sessionInfo.innerHTML = "ƒêang k·∫øt n·ªëi...";
waitingText.innerHTML = "ƒêang t·∫£i d·ªØ li·ªáu...";
confidenceBox.style.display = "none";
return;
}
sessionInfo.innerHTML = `Phi√™n: #${phienTiepTheo}`;
sessionInfo.style.display = "block";
if(lastSession !== phienHienTai){
lastSession = phienHienTai;
lastPredictedSession = null;
triggerRobotEffect();
}
if(pred && (pred==="T√†i" || pred==="X·ªâu")){
let color = pred==="T√†i" ? "#00ff00" : "#ff4444";
let viText = viDuDoan.length > 0 ? `<br><span style="font-size:12px;color:#00e6b4">V·ªã: ${viDuDoan.join(', ')}</span>` : "";
let fullHtml = `D·ª± ƒëo√°n: <span style="color:${color};font-size:26px;font-weight:900;text-shadow:0 0 15px ${color}">${pred}</span>${viText}`;
if (waitingText.getAttribute('data-last') !== pred) {
    typeWriter(waitingText, `D·ª± ƒëo√°n: ${pred}`, fullHtml);
    waitingText.setAttribute('data-last', pred);
} else {
    waitingText.innerHTML = fullHtml;
}
confidenceText.innerHTML = `${confPercent}%`;
confidenceBox.style.display = "block";
lastPredictedSession = phienHienTai;
}else{
waitingText.innerHTML = "ƒêang ch·ªù k·∫øt qu·∫£...";
confidenceBox.style.display = "none";
}
if(data.history) renderHistory(data.history);
}

function updateHitB52(data){
let phienEl=document.getElementById("phienText");
let predEl=document.getElementById("prediction");
let resultEl=document.getElementById("result");
let statusEl=document.getElementById("status");
if(!phienEl) return;
let phien = data.phien || "N/A";
let phienTiepTheo = phien !== "N/A" ? (parseInt(phien) + 1) : "N/A";
if(phien!=="N/A" && lastSession!==phien){
lastSession=phien;
triggerRobotEffect();
}
phienEl.textContent="#"+phienTiepTheo;
let pred=data.du_doan || "N/A";
let color=pred==="T√†i"?"#00ff00":"#ff4444";
predEl.innerHTML=`<span style="color:${color};text-shadow:0 0 15px ${color};">${pred}</span>`;
resultEl.textContent=data.ket_qua || "ƒêang ch·ªù...";
statusEl.innerHTML='<span style="color:#00ff00">‚óè</span> ƒê√£ k·∫øt n·ªëi';
if(data.history) renderHistory(data.history);
updateRobotUI(phien, pred, data.do_tin_cay);
}

function updateTime(){
let now=new Date();
let h=now.getHours().toString().padStart(2,'0');
let m=now.getMinutes().toString().padStart(2,'0');
let s=now.getSeconds().toString().padStart(2,'0');
let clockEl=document.getElementById("clock");
if(clockEl) clockEl.textContent=h+':'+m+':'+s;
}

setInterval(refresh, 3000);

setInterval(updateTime, 1000);
updateTime();
refresh();

particlesJS("particles-js",{
particles:{
number:{value:120,density:{enable:true,value_area:800}},
color:{value:["#00ffff","#00aaff","#0088ff","#ffffff"]},
shape:{type:"circle",stroke:{width:0,color:"#000000"}},
opacity:{value:0.7,random:true,anim:{enable:true,speed:1,opacity_min:0.1,sync:false}},
size:{value:3,random:true,anim:{enable:true,speed:2,size_min:0.1,sync:false}},
line_linked:{enable:true,distance:150,color:"#00aaff",opacity:0.3,width:1},
move:{enable:true,speed:1,direction:"none",random:true,straight:false,out_mode:"out",bounce:false,attract:{enable:true,rotateX:600,rotateY:1200}}
},
interactivity:{
detect_on:"canvas",
events:{onhover:{enable:true,mode:"bubble"},onclick:{enable:true,mode:"push"},resize:true},
modes:{bubble:{distance:200,size:6,duration:2,opacity:0.8,speed:3},push:{particles_nb:4}}
},
retina_detect:true
});
</script>
</head>
<body>
<div id="particles-js"></div>
<div class="header">
<div class="game-title">üé≤ B52</div>
<a href="/menu" class="back-btn">‚Üê Menu</a>
</div>



<div class="wrapper" style="display:block">
<h2 class="game-title-main">
<span class="float-1">D·ª∞</span>
<span class="float-2">ƒêO√ÅN</span>
<span class="float-3">T√ÄI</span>
<span class="float-4">X·ªàU</span>
</h2>
<div class="prediction-box">
<div class="prediction-item">
<div class="label">Phi√™n ti·∫øp theo</div>
<div class="value" id="phienText">#---</div>
</div>
<div class="prediction-item">
<div class="label">D·ª± ƒëo√°n</div>
<div class="value prediction-value" id="prediction">--</div>
</div>
</div>
<div class="status-info">
<div class="status-row">
<span class="stat-label">üìä K·∫øt qu·∫£ tr∆∞·ªõc:</span>
<span class="stat-value" id="result">ƒêang ch·ªù...</span>
</div>
<div class="status-row">
<span class="stat-label">üîó Tr·∫°ng th√°i:</span>
<span class="stat-value" id="status">ƒêang k·∫øt n·ªëi...</span>
</div>
<div class="status-row">
<span class="stat-label">üïê Th·ªùi gian:</span>
<span class="stat-value" id="clock">--:--:--</span>
</div>
</div>
</div>


</body>
</html>