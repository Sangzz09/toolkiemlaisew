<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Nạp Tiền - SHOP MINHSANG</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',system-ui,sans-serif;background:linear-gradient(135deg,#0a1628 0%,#0d1f36 50%,#112a45 100%);color:#fff;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:15px}
.wrap{width:100%;max-width:460px}
.card{background:rgba(13,31,54,0.98);padding:28px 22px;border-radius:22px;box-shadow:0 20px 60px rgba(0,0,0,0.6);border:1px solid rgba(0,230,180,0.15);position:relative;overflow:hidden}
.card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,transparent,#00e6b4,transparent);animation:shine 3s infinite}
@keyframes shine{0%,100%{opacity:.3}50%{opacity:1}}
.back{display:inline-flex;align-items:center;gap:6px;color:rgba(255,255,255,0.5);text-decoration:none;font-size:13px;margin-bottom:18px;transition:.2s}
.back:hover{color:#00e6b4}
.ttl{font-size:21px;font-weight:bold;text-align:center;background:linear-gradient(135deg,#00e6b4,#00b4d8);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:4px}
.sub{text-align:center;color:rgba(255,255,255,.45);font-size:12px;margin-bottom:20px}
.bal{display:flex;align-items:center;justify-content:center;gap:8px;background:rgba(0,230,180,.07);border:1px solid rgba(0,230,180,.2);border-radius:10px;padding:11px 18px;margin-bottom:22px;font-size:14px}
.bal b{color:#00e6b4;font-size:16px}
.lbl{color:rgba(255,255,255,.65);font-size:12px;font-weight:600;margin-bottom:8px}
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:12px}
.ab{background:rgba(0,230,180,.07);border:1px solid rgba(0,230,180,.2);border-radius:9px;color:#fff;font-size:13px;font-weight:600;padding:11px 4px;cursor:pointer;transition:.2s;text-align:center}
.ab:hover,.ab.on{background:rgba(0,230,180,.18);border-color:#00e6b4;color:#00e6b4}
input[type=number]{width:100%;padding:12px 14px;background:rgba(0,230,180,.05);border:1.5px solid rgba(0,230,180,.2);border-radius:10px;color:#fff;font-size:15px;outline:none;transition:.2s;margin-bottom:16px}
input[type=number]:focus{border-color:#00e6b4}
input::placeholder{color:rgba(255,255,255,.3)}
.btn{width:100%;padding:14px;background:linear-gradient(135deg,#00e6b4,#00b4d8);border:none;border-radius:11px;font-size:16px;font-weight:bold;color:#0a1628;cursor:pointer;transition:.3s;box-shadow:0 8px 20px rgba(0,230,180,.25)}
.btn:hover{transform:translateY(-2px);box-shadow:0 12px 28px rgba(0,230,180,.4)}
.err{background:rgba(255,80,80,.1);border:1px solid rgba(255,80,80,.3);color:#ff8888;padding:11px 14px;border-radius:9px;font-size:13px;margin-bottom:16px;text-align:center}
.binfo{background:rgba(0,230,180,.07);border:1px solid rgba(0,230,180,.18);border-radius:14px;padding:18px;margin-bottom:14px}
.row{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid rgba(255,255,255,.06)}
.row:last-child{border:none}
.rl{color:rgba(255,255,255,.5);font-size:12px}
.rv{color:#fff;font-size:13px;font-weight:600;text-align:right}
.rv.hi{color:#00e6b4;font-size:14px}
.cp{background:none;border:1px solid rgba(0,230,180,.35);color:#00e6b4;border-radius:5px;padding:2px 9px;font-size:11px;cursor:pointer;margin-left:7px;transition:.2s}
.cp:hover{background:rgba(0,230,180,.15)}
.cbox{background:rgba(0,230,180,.1);border:1.5px dashed rgba(0,230,180,.5);border-radius:9px;padding:13px;margin-bottom:14px;text-align:center}
.cl{color:rgba(255,255,255,.45);font-size:11px;margin-bottom:5px}
.cv{color:#00ff99;font-size:18px;font-weight:bold;letter-spacing:1.5px;word-break:break-all}
.warn{background:rgba(255,200,0,.07);border:1px solid rgba(255,200,0,.2);border-radius:9px;padding:12px 14px;font-size:12px;color:rgba(255,215,100,.9);line-height:1.7;margin-bottom:14px}
.qrbox{text-align:center;margin-bottom:14px}
.qrbox img{width:200px;height:200px;border-radius:12px;background:#fff;padding:8px}
.waiting{text-align:center;color:rgba(255,255,255,.5);font-size:13px;padding:10px 0;margin-bottom:8px}
.waiting span{color:#00e6b4;font-weight:bold}
@keyframes popIn{0%{transform:scale(0)}80%{transform:scale(1.15)}100%{transform:scale(1)}}
</style>
</head>
<body>
<div class="wrap">
<div class="card" id="mainCard">
  <a href="/menu" class="back">&#8592; Quay lại</a>
  <div class="ttl">&#128179; Nạp Tiền</div>
  <div class="sub">Thanh toán tự động &middot; Cộng tiền ngay lập tức</div>
  <div class="bal">&#128176; Số dư: <b>{{ "{:,}".format(balance) }}đ</b></div>
  {% if error %}<div class="err">&#9888; {{ error }}</div>{% endif %}

  {% if not transfer_content %}
  <form method="POST">
    <div class="lbl">&#128181; Chọn số tiền</div>
    <div class="grid">
      <button type="button" class="ab" onclick="pick(20000,this)">20,000đ</button>
      <button type="button" class="ab" onclick="pick(50000,this)">50,000đ</button>
      <button type="button" class="ab" onclick="pick(100000,this)">100,000đ</button>
      <button type="button" class="ab" onclick="pick(200000,this)">200,000đ</button>
      <button type="button" class="ab" onclick="pick(500000,this)">500,000đ</button>
      <button type="button" class="ab" onclick="pick(1000000,this)">1,000,000đ</button>
    </div>
    <div class="lbl">&#9999; Hoặc nhập số khác</div>
    <input type="number" name="amount" id="amt" placeholder="Tối thiểu 10,000đ" min="10000" step="1000">
    <button type="submit" class="btn">&#128273; Tạo Lệnh Nạp</button>
  </form>

  {% else %}
  <div class="binfo">
    <div class="row"><span class="rl">&#127970; Ngân hàng</span><span class="rv">MBBank</span></div>
    <div class="row">
      <span class="rl">&#128179; Số tài khoản</span>
      <span class="rv hi">0886027767 <button class="cp" onclick="cp('0886027767',this)">Copy</button></span>
    </div>
    <div class="row"><span class="rl">&#128100; Chủ TK</span><span class="rv">TRAN MINH SANG</span></div>
    <div class="row"><span class="rl">&#128176; Số tiền</span><span class="rv hi">{{ "{:,}".format(amount_chosen) }}đ</span></div>
  </div>

  <div class="qrbox">
    <img src="https://img.vietqr.io/image/MB-0886027767-compact2.png?amount={{ amount_chosen }}&addInfo={{ transfer_content | urlencode }}&accountName=TRAN%20MINH%20SANG" alt="QR Code">
  </div>

  <div class="cbox">
    <div class="cl">&#9888; NỘI DUNG CHUYỂN KHOẢN &mdash; GHI ĐÚNG Y CHANG</div>
    <div class="cv" id="tc">{{ transfer_content }}</div>
    <button class="cp" style="margin-top:9px;padding:5px 16px;font-size:12px" onclick="cp('{{ transfer_content }}',this)">&#128203; Copy nội dung</button>
  </div>

  <div class="warn">
    &#9888; <b>Quan trọng:</b><br>
    &bull; Quét QR hoặc CK tay với <b>đúng nội dung</b> trên<br>
    &bull; Tiền cộng <b>tự động</b> sau khi ngân hàng xử lý<br>
    &bull; Lệnh hết hạn sau <b id="cd" style="color:#ffcc44">15:00</b>
  </div>

  <div class="waiting">&#9203; Đang chờ giao dịch...<br>Xin chờ <span>1-3 phút</span> sau khi chuyển khoản</div>
  {% endif %}
</div>
</div>
<script>
function pick(v,el){
  document.getElementById('amt').value=v;
  document.querySelectorAll('.ab').forEach(function(b){b.classList.remove('on');});
  el.classList.add('on');
}
function cp(txt,btn){
  navigator.clipboard.writeText(txt).catch(function(){
    var t=document.createElement('textarea');
    t.value=txt;document.body.appendChild(t);t.select();
    document.execCommand('copy');document.body.removeChild(t);
  });
  var o=btn.textContent;btn.textContent='Da copy!';
  setTimeout(function(){btn.textContent=o;},2000);
}
{% if transfer_content %}
var s=900;
var cd=document.getElementById('cd');
setInterval(function(){
  s--;
  if(s<=0){cd.textContent='HET HAN';cd.style.color='#ff4444';return;}
  cd.textContent=String(Math.floor(s/60)).padStart(2,'0')+':'+String(s%60).padStart(2,'0');
},1000);
var prev={{ balance }};
setInterval(function(){
  fetch('/api/balance').then(function(r){return r.json();}).then(function(d){
    if(d.balance>prev){
      var added=d.balance-prev;
      document.getElementById('mainCard').innerHTML=
        '<div style="text-align:center;padding:20px 10px">'+
        '<div style="font-size:64px;margin-bottom:16px;animation:popIn .4s ease">&#9989;</div>'+
        '<div style="font-size:22px;font-weight:bold;color:#00e6b4;margin-bottom:8px">Nap Tien Thanh Cong!</div>'+
        '<div style="color:rgba(255,255,255,.6);font-size:14px;margin-bottom:24px">He thong da tu dong cong tien vao tai khoan</div>'+
        '<div style="background:rgba(0,230,180,.1);border:1px solid rgba(0,230,180,.3);border-radius:14px;padding:20px;margin-bottom:20px">'+
        '<div style="color:rgba(255,255,255,.5);font-size:12px;margin-bottom:6px">SO TIEN DUOC CONG</div>'+
        '<div style="font-size:36px;font-weight:bold;color:#00ff99">+'+added.toLocaleString('vi-VN')+'d</div></div>'+
        '<div style="background:rgba(255,255,255,.05);border-radius:10px;padding:14px;margin-bottom:20px">'+
        '<div style="color:rgba(255,255,255,.45);font-size:11px;margin-bottom:4px">SO DU MOI</div>'+
        '<div style="font-size:22px;font-weight:bold;color:#00e6b4">'+d.balance.toLocaleString('vi-VN')+'d</div></div>'+
        '<a href="/account" style="display:block;padding:14px;background:linear-gradient(135deg,#00e6b4,#00b4d8);border-radius:11px;font-size:16px;font-weight:bold;color:#0a1628;text-decoration:none;text-align:center;margin-bottom:10px">Xem tai khoan</a>'+
        '<a href="/buy-key" style="display:block;padding:13px;background:rgba(0,230,180,.1);border:1px solid rgba(0,230,180,.3);border-radius:11px;font-size:15px;color:#00e6b4;text-decoration:none;text-align:center">Mua key ngay</a>'+
        '</div>';
    }
  }).catch(function(){});
},8000);
{% endif %}
</script>
</body>
</html>